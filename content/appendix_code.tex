\section{Esquema OpenAPI de la API de gesti√≥n} \label{openapi-schema}
\begin{minted}[linenos,tabsize=2,breaklines,fontsize=\footnotesize]{json}
components:
  schemas:
    ErrorDetail:
      additionalProperties: false
      properties:
        location:
          description: Where the error occurred, e.g. 'body.items[3].tags' or 'path.thing-id'
          type: string
        message:
          description: Error message text
          type: string
        value:
          description: The value at the given location
      type: object
    ErrorModel:
      additionalProperties: false
      properties:
        $schema:
          description: A URL to the JSON Schema for this object.
          format: uri
          readOnly: true
          type: string
        detail:
          description: A human-readable explanation specific to this occurrence of the problem.
          examples:
            - Property foo is required but is missing.
          type: string
        errors:
          description: Optional list of individual error details
          items:
            $ref: "#/components/schemas/ErrorDetail"
          type: array
        instance:
          description: A URI reference that identifies the specific occurrence of the problem.
          examples:
            - https://example.com/error-log/abc123
          format: uri
          type: string
        status:
          description: HTTP status code
          examples:
            - 400
          format: int64
          type: integer
        title:
          description: A short, human-readable summary of the problem type. This value should not change between occurrences of the error.
          examples:
            - Bad Request
          type: string
        type:
          default: about:blank
          description: A URI reference to human-readable documentation for the error.
          examples:
            - https://example.com/errors/example
          format: uri
          type: string
      type: object
    GithubUserMapping:
      additionalProperties: false
      properties:
        email:
          description: The email address that the github user will use in GoRace
          examples:
            - user@example.tld
          format: email
          type: string
        username:
          description: The github username of the student
          examples:
            - studentuser1
          type: string
      required:
        - email
        - username
      type: object
    Race:
      additionalProperties: false
      properties:
        $schema:
          description: A URL to the JSON Schema for this object.
          format: uri
          readOnly: true
          type: string
        id:
          examples:
            - 1
          format: int64
          readOnly: true
          type: integer
        jwt:
          description: The JWT from the GoRace Admin app used to access the race data
          examples:
            - eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsInN1YiI6MSwiZGF0YSI6IjY5IiwiaWF0IjoxfQ.a-WxLgcMRkbZ0Q1MQjveLjusQU49oANK1lO0YwB1A7M
          type: string
          writeOnly: true
        name:
          description: The name of the race. It does not need to match the name in the GoRace application.
          examples:
            - race1
          maxLength: 20
          minLength: 3
          pattern: "[\\p{L}-_\\d]+"
          type: string
      required:
        - name
        - id
      type: object
    User:
      additionalProperties: false
      properties:
        $schema:
          description: A URL to the JSON Schema for this object.
          format: uri
          readOnly: true
          type: string
        githubToken:
          description: The GitHub token of the user generated by CLI app.
          examples:
            - ghp_1234567890abcdef1234567890abcdef12345678
          pattern: gh[a-z]_[[:alnum:]]{36}
          type: string
          writeOnly: true
        id:
          examples:
            - 1
          format: int64
          type: integer
        username:
          description: The nickname of the user. Can contain any character except control characters.
          examples:
            - user1
          maxLength: 20
          minLength: 3
          pattern: \P{C}+
          type: string
      required:
        - username
        - id
      type: object
    updateRaceJWTInputBody:
      additionalProperties: false
      properties:
        $schema:
          description: A URL to the JSON Schema for this object.
          format: uri
          readOnly: true
          type: string
        jwt:
          description: Refer to Race.JWT
          examples:
            - eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsInN1YiI6MSwiZGF0YSI6IjY5IiwiaWF0IjoxfQ.a-WxLgcMRkbZ0Q1MQjveLjusQU49oANK1lO0YwB1A7M
          type: string
          writeOnly: true
      required:
        - jwt
      type: object
  securitySchemes:
    bearer:
      bearerFormat: JWT
      scheme: bearer
      type: http
info:
  title: GH2GR API
  version: 0.1.0
openapi: 3.1.0
paths:
  /races:
    get:
      description: Returns all races owned by the current user
      operationId: list-races
      responses:
        "200":
          content:
            application/json:
              schema:
                items:
                  $ref: "#/components/schemas/Race"
                type: array
          description: OK
        default:
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ErrorModel"
          description: Error
      security:
        - bearer: []
      summary: List races
      tags:
        - races
    post:
      description: Creates a new race, making the current user the owner
      operationId: create-race
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Race"
        required: true
      responses:
        "201":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Race"
          description: Created
        default:
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ErrorModel"
          description: Error
      security:
        - bearer: []
      summary: Add a race
      tags:
        - races
  /races/{race-id}:
    delete:
      description: Remove a race from the database. All associated github username mappigs will be deleted by it. Only an owner of the given race can delete it.
      operationId: delete-race
      parameters:
        - example: 42
          in: path
          name: race-id
          required: true
          schema:
            description: The ID of the race to be deleted.
            examples:
              - 42
            format: int64
            type: integer
      responses:
        "204":
          description: No Content
        default:
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ErrorModel"
          description: Error
      security:
        - bearer: []
      summary: Delete a race
      tags:
        - races
    get:
      description: Retrieves the race with the given ID. The current user must be an owner of the race
      operationId: get-race
      parameters:
        - example: 42
          in: path
          name: race-id
          required: true
          schema:
            description: The ID of the race that you wish to retrieve.
            examples:
              - 42
            format: int64
            type: integer
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Race"
          description: OK
        default:
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ErrorModel"
          description: Error
      security:
        - bearer: []
      summary: Get a race
      tags:
        - races
  /races/{race-id}/update-jwt:
    put:
      description: Updates the GoRace JWT token of a race you own.
      operationId: update-race-jwt
      parameters:
        - example: 42
          in: path
          name: race-id
          required: true
          schema:
            description: The ID of the race to be deleted.
            examples:
              - 42
            format: int64
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/updateRaceJWTInputBody"
        required: true
      responses:
        "204":
          description: No Content
        default:
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ErrorModel"
          description: Error
      security:
        - bearer: []
      summary: Update Race JWT
      tags:
        - races
  /races/{race-id}/user-mappings:
    post:
      description: Map Github users to the email addresses to be used in GoRace. It sends preregistration emails to the email addresses. Sending a username that was previously associated with an email, will overwrite the previous value
      operationId: add-github-user-mapping
      parameters:
        - example: 42
          in: path
          name: race-id
          required: true
          schema:
            description: The ID of the race that will receive the github user mappings
            examples:
              - 42
            format: int64
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              items:
                $ref: "#/components/schemas/GithubUserMapping"
              type: array
        required: true
      responses:
        "204":
          description: No Content
        default:
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ErrorModel"
          description: Error
      security:
        - bearer: []
      summary: Add Github user mappings to a race
      tags:
        - github-user-mappings
  /user:
    get:
      description: Retrieves the user data associated with the auth token used to make the request.
      operationId: get-current-user
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
          description: OK
        default:
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ErrorModel"
          description: Error
      security:
        - bearer: []
      summary: Get current user
      tags:
        - current-user
    put:
      description: Updates the user data associated with the auth token used to make the request.
      operationId: update-current-user
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/User"
        required: true
      responses:
        "204":
          description: No Content
        default:
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ErrorModel"
          description: Error
      security:
        - bearer: []
      summary: Update current user
      tags:
        - current-user
\end{minted}